var Klotski=Klotski||{};Klotski.init=function(){this.Browser=Laya.Browser,this.WebGL=Laya.WebGL,this.Stage=Laya.Stage,this.Stat=Laya.Stat,this.Handler=Laya.Handler,this.Image=Laya.Image,this.Text=Laya.Text,this.Tween=Laya.Tween,this.Sprite=Laya.Sprite,this.Event=Laya.Event,this.Animation=Laya.Animation,this.TimeLine=Laya.TimeLine,Laya.init(750,1624,Laya.WebGL),Laya.stage.scaleMode="fixedwidth",Laya.stage.screenMode=Laya.Stage.SCREEN_VERTICAL,Laya.stage.alignH="center",Laya.stage.alignV="middle",this.order=0,this.step=0,this.points=[],this.place=[],this.loadArr()},Klotski.stype={row:4,cols:5,pointStartX:17,pointStartY:160,spaceX:144,spaceY:144},Klotski.loadArr=function(){this.loader=Laya.loader,this.urls=["img/bg.png","img/btn.png","img/frame.png","img/person.atlas"],this.loader.load(this.urls,this.Handler.create(this,this.onAssetloadedUI),this.Handler.create(this,this.onLoading,null,!1))},Klotski.onLoading=function(t){console.log("加载进度: "+t)},Klotski.onAssetloadedUI=function(){this.bg=new this.Sprite,this.bg.loadImage("img/bg.png"),Laya.stage.addChild(this.bg),this.frame=new this.Sprite,this.frame.loadImage("img/frame.png"),Laya.stage.addChild(this.frame),this.frame.x=56,this.frame.y=Laya.stage.height-this.frame.height>>1,this.loadSurFace(),this.loadBtn(),this.loadInfo()},Klotski.loadInfo=function(){var t=arrayList[this.order];this.place=t.place.arr2Clone();for(var i=0;i<this.stype.cols;i++)for(var s=0;s<this.stype.row;s++){var h=t.place[i][s];h<4?this.loadPerson(i,s,"person/soldiers1.jpg",[0,0,144,0,144,144,0,144,0,0],h):h>=4&&h<9?(t.place[i][s+1]&&h==t.place[i][s+1]&&this.loadPerson(i,s,"person/General2_"+(h-3)+".jpg",[0,0,288,0,288,144,0,144,0,0],h,1),t.place[i+1]&&h==t.place[i+1][s]&&this.loadPerson(i,s,"person/General1_"+(h-3)+".jpg",[0,0,144,0,144,288,0,288,0,0],h,2)):9==h&&t.place[i+1]&&h==t.place[i][s+1]&&h==t.place[i+1][s+1]&&h==t.place[i+1][s]&&this.loadPerson(i,s,"person/Principal.jpg",[0,0,288,0,288,288,0,288,0,0],h)}this.frame.on(this.Event.MOUSE_DOWN,this,this.onMouseDown),this.frame.on(this.Event.MOUSE_MOVE,this,this.onMouseMove),this.frame.on(this.Event.MOUSE_UP,this,this.onMouseUp),this.frame.on(this.Event.MOUSE_OUT,this,this.onMouseUp),this.title.text=this.order+1+"、"+arrayList[this.order].name},Klotski.loadSurFace=function(){this.title=new this.Text,this.title.text=this.order+1+"、"+arrayList[this.order].name,this.frame.addChild(this.title),this.title.fontSize=36,this.title.color="#ffffff",this.title.x=20,this.title.y=60,this.stepTit=new this.Text,this.stepTit.text="步数："+this.step,this.frame.addChild(this.stepTit),this.stepTit.fontSize=36,this.stepTit.color="#ffffff",this.stepTit.x=420,this.stepTit.y=60},Klotski.loadBtn=function(){this.nextBtn=new Btn({bg:"img/btn.png",x:500,y:30+(Laya.stage.height+this.frame.height>>1),text:"下一关"}),Laya.stage.addChild(this.nextBtn),this.nextBtn.on(this.Event.MOUSE_DOWN,this,this.next),this.preBtn=new Btn({bg:"img/btn.png",x:100,y:30+(Laya.stage.height+this.frame.height>>1),text:"上一关"}),Laya.stage.addChild(this.preBtn),this.preBtn.on(this.Event.MOUSE_DOWN,this,this.pre),this.ResetBtn=new Btn({bg:"img/btn.png",x:300,y:30+(Laya.stage.height+this.frame.height>>1),text:"重置"}),Laya.stage.addChild(this.ResetBtn),this.ResetBtn.on(this.Event.MOUSE_DOWN,this,this.Reset),this.strategy=new Btn({bg:"img/btn.png",x:500,y:(Laya.stage.height-this.frame.height>>1)-100,text:"攻略"}),Laya.stage.addChild(this.strategy),this.strategy.on(this.Event.MOUSE_DOWN,this,function(){return new Confirm({text:"联系作者微信q411799907,并发送一元红包",left:"取消",right:"确认",width:500,height:300},this,function(t){}),!1})},Klotski.Reset=function(){for(var t=0;t<this.points.length;t++){this.points.shift().destroy(),t--}this.loadInfo(),this.step=0,this.stepTit.text="步数："+this.step},Klotski.next=function(){if(this.order==arrayList.length-1)return new Confirm({text:"已是最后一关，敬请更新",left:"取消",right:"确认",width:500,height:300},this,function(t){}),!1;this.order++,this.Reset()},Klotski.pre=function(){if(0==this.order)return new Confirm({text:"已是第一关，前面无关卡",left:"取消",right:"确认",width:500,height:300},this,function(t){}),!1;this.order--,this.Reset()},Klotski.loadPerson=function(t,i,s,h,e,n){var o=new this.Sprite;o.loadImage(s),this.frame.addChild(o),o.x=this.countX(i),o.y=this.countY(t),o.graphics.drawLines(0,0,h,"#996a36",3),o.pointX=i,o.pointY=t,o.place=e,o.direction=n,this.points.push(o)},Klotski.countX=function(t){return t*this.stype.spaceX+this.stype.pointStartX},Klotski.countY=function(t){return t*this.stype.spaceY+this.stype.pointStartY},Klotski.onMouseDown=function(t){if(t.touches&&2==t.touches.length)return!1;this.startX=t.stageX,this.startY=t.stageY;for(var i=0;i<this.points.length;i++)if(this.points[i].hitTestPoint(this.startX,this.startY)){this.point=this.points[i],this.result=this.bylaw(this.point),this.pointX=this.point.x,this.pointY=this.point.y,this.result.xarr.push(this.point.pointX),this.result.yarr.push(this.point.pointY);break}},Klotski.onMouseMove=function(t){if(t.touches&&2==t.touches.length)return!1;this.point&&this.result.arr.length&&(1==this.result.direction.length?"x"==this.result.direction[0]?this.point.x=Math.max(Math.min(t.stageX-this.startX+this.pointX,this.countX(Math.max.apply(null,this.result.xarr))),this.countX(Math.min.apply(null,this.result.xarr))):this.point.y=Math.max(Math.min(t.stageY-this.startY+this.pointY,this.countY(Math.max.apply(null,this.result.yarr))),this.countY(Math.min.apply(null,this.result.yarr))):2==this.result.direction.length&&(this.point.x==this.countX(this.point.pointX)&&this.point.y==this.countY(this.point.pointY)&&(Math.abs(t.stageX-this.startX)>Math.abs(t.stageY-this.startY)?this.touchDir="x":this.touchDir="y"),"x"==this.touchDir?this.point.x=Math.max(Math.min(t.stageX-this.startX+this.pointX,this.countX(Math.max.apply(null,this.result.xarr))),this.countX(Math.min.apply(null,this.result.xarr))):this.point.y=Math.max(Math.min(t.stageY-this.startY+this.pointY,this.countY(Math.max.apply(null,this.result.yarr))),this.countY(Math.min.apply(null,this.result.yarr)))))},Klotski.onMouseUp=function(t){if(t.touches&&2==t.touches.length||!this.point)return!1;if(this.placeReset(),"x"==this.result.direction[0]&&1==this.result.direction.length||"x"==this.touchDir){(i=Math.round((this.point.x-this.pointX)/this.stype.spaceX))&&(this.stepTit.text="步数："+ ++this.step),this.point.pointX+=i,this.Tween.to(this.point,{x:this.countX(this.point.pointX)},50)}if("y"==this.result.direction[0]&&1==this.result.direction.length||"y"==this.touchDir){var i=Math.round((this.point.y-this.pointY)/this.stype.spaceY);i&&(this.stepTit.text="步数："+ ++this.step),this.point.pointY+=i,this.Tween.to(this.point,{y:this.countY(this.point.pointY)},50)}this.placeLocation(),9==this.point.place&&3==this.point.pointY&&1==this.point.pointX&&this.winer(),this.step>=1e3&&33==this.order&&new Confirm({text:"哈哈哈，这关是无解的，快去试试其他关吧",left:"取消",right:"下一关",width:500,height:300},this,function(t){t&&this.next()}),this.point=null,this.touchDir=null},Klotski.winer=function(){new Confirm({text:"恭喜过关，是否开始下一关",left:"取消",right:"下一关",width:500,height:300},this,function(t){t&&this.next()}),this.frame.off(this.Event.MOUSE_DOWN,this,this.onMouseDown),this.frame.off(this.Event.MOUSE_MOVE,this,this.onMouseMove),this.frame.off(this.Event.MOUSE_UP,this,this.onMouseUp),this.frame.off(this.Event.MOUSE_OUT,this,this.onMouseUp)},Klotski.placeReset=function(){this.point.place<4?this.place[this.point.pointY][this.point.pointX]=10:this.point.place>=4&&this.point.place<9?(1==this.point.direction&&(this.place[this.point.pointY][this.point.pointX]=10,this.place[this.point.pointY][this.point.pointX+1]=10),2==this.point.direction&&(this.place[this.point.pointY][this.point.pointX]=10,this.place[this.point.pointY+1][this.point.pointX]=10)):9==this.point.place&&(this.place[this.point.pointY][this.point.pointX]=10,this.place[this.point.pointY][this.point.pointX+1]=10,this.place[this.point.pointY+1][this.point.pointX]=10,this.place[this.point.pointY+1][this.point.pointX+1]=10)},Klotski.placeLocation=function(){this.point.place<4?this.place[this.point.pointY][this.point.pointX]=this.point.place:this.point.place>=4&&this.point.place<9?(1==this.point.direction&&(this.place[this.point.pointY][this.point.pointX]=this.point.place,this.place[this.point.pointY][this.point.pointX+1]=this.point.place),2==this.point.direction&&(this.place[this.point.pointY][this.point.pointX]=this.point.place,this.place[this.point.pointY+1][this.point.pointX]=this.point.place)):9==this.point.place&&(this.place[this.point.pointY][this.point.pointX]=this.point.place,this.place[this.point.pointY][this.point.pointX+1]=this.point.place,this.place[this.point.pointY+1][this.point.pointX]=this.point.place,this.place[this.point.pointY+1][this.point.pointX+1]=this.point.place)},Klotski.bylaw=function(t){var i=t.pointX,s=t.pointY,h=[],e=[],n=[],o=[];if(t.place<4){for(p=i-1;p>=0&&10==this.place[s][p];p--)h.push([s,p]),e.push("x"),n.push(p);for(p=i+1;p<this.stype.row&&10==this.place[s][p];p++)h.push([s,p]),e.push("x"),n.push(p);for(p=s-1;p>=0&&10==this.place[p][i];p--)h.push([p,i]),e.push("y"),o.push(p);for(p=s+1;p<this.stype.cols&&10==this.place[p][i];p++)h.push([p,i]),e.push("y"),o.push(p)}else if(t.place<9)if(1==t.direction){for(p=i-1;p>=0&&10==this.place[s][p];p--)h.push([s,p]),e.push("x"),n.push(p);for(p=i+2;p<this.stype.row&&10==this.place[s][p];p++)h.push([s,p-1]),e.push("x"),n.push(p-1);for(p=s-1;p>=0&&(10==this.place[p][i]&&10==this.place[p][i+1]);p--)h.push([p,i]),e.push("y"),o.push(p);for(p=s+1;p<this.stype.cols&&(10==this.place[p][i]&&10==this.place[p][i+1]);p++)h.push([p,i]),e.push("y"),o.push(p)}else{for(p=i-1;p>=0&&(10==this.place[s][p]&&10==this.place[s+1][p]);p--)h.push([s,p]),e.push("x"),n.push(p);for(p=i+1;p<this.stype.row&&(10==this.place[s][p]&&10==this.place[s+1][p]);p++)h.push([s,p]),e.push("x"),n.push(p);for(p=s-1;p>=0&&10==this.place[p][i];p--)h.push([p,i]),e.push("y"),o.push(p);for(p=s+2;p<this.stype.cols&&10==this.place[p][i];p++)h.push([p-1,i]),e.push("y"),o.push(p-1)}else if(9==t.place){for(p=i-1;p>=0&&(10==this.place[s][p]&&10==this.place[s+1][p]);p--)h.push([s,p]),e.push("x"),n.push(p);for(p=i+2;p<this.stype.row&&(10==this.place[s][p]&&10==this.place[s+1][p]);p++)h.push([s,p-1]),e.push("x"),n.push(p-1);for(p=s-1;p>=0&&(10==this.place[p][i]&&10==this.place[p][i+1]);p--)h.push([p,i]),e.push("y"),o.push(p);for(var p=s+2;p<this.stype.cols&&(10==this.place[p][i]&&10==this.place[p][i+1]);p++)h.push([p-1,i]),e.push("y"),o.push(p-1)}return e=Array.from(new Set(e)),{arr:h,direction:e,xarr:n,yarr:o}},Klotski.init();